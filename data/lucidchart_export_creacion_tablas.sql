CREATE TABLE [AUTO_PARTE] (
  [AUTO_PARTE_CODIGO] decimal(18,0),
  [AUTO_PARTE_DESCRIPCION] nvarchar(255),
  [AUTO_PARTE_FABRICANTE_COD] decimal(18,0) NOT NULL REFERENCES AUTO_PARTE_X_FABRICANTE,
  PRIMARY KEY ([AUTO_PARTE_CODIGO])
);

CREATE TABLE [TIPO_TRANSMISION] (
  [TIPO_TRANSMISION_CODIGO] decimal(18,0),
  [TIPO_TRANSMISION_DESC] nvarchar(255),
  PRIMARY KEY ([TIPO_TRANSMISION_CODIGO])
);

CREATE TABLE [AUTO_MODELO] (
  [MODELO_CODIGO] decimal(18,0),
  [MODELO_NOMBRE] nvarchar(255),
  [MODELO_POTENCIA] decimal(18,0) NOT NULL,
  [MODELO_CAJA_COD] decimal(18,0) NOT NULL REFERENCES TIPO_CAJA,
  [MODELO_TRANSMISION_COD] decimal(18,0) NOT NULL REFERENCES TIPO_TRANSMISION,
  [MODELO_TIPO_MOTOR_CODIGO] decimal(18,0) NOT NULL,
  PRIMARY KEY ([MODELO_CODIGO])
);

CREATE TABLE [PRODUCTO_OPERACION] (
  [PRODUCTO_CODIGO] decimal(18,0) IDENTITY (1,1),
  [PRODUCTO_TIPO] nvarchar(255),
  [PRODUCTO_TIPO_DESC] nvarchar(255),
  [PRODUCTO_PRECIO_UNITARIO] decimal(18,2) DEFAULT 0,
  [PRODUCTO_TIPO_TRANSACT] nvarchar(255) NOT NULL,
  PRIMARY KEY ([PRODUCTO_CODIGO], [PRODUCTO_TIPO]), 
  CONSTRAINT ck_tipo_transact CHECK ([PRODUCTO_TIPO_TRANSACT] IN ('Venta','Compra'))
  CONSTRAINT ck_tipo_prod CHECK ([PRODUCTO_TIPO] IN ('Auto','Autoparte'))
);

CREATE TABLE [AUTO] (
  [AUTO_CODIGO] decimal(18,0),
  [AUTO_NRO_MOTOR] nvarchar(50) NOT NULL,
  [AUTO_NRO_CHASIS] nvarchar(50) NOT NULL,
  [AUTO_PATENTE] nvarchar(50),
  [AUTO_CANT_KMS] decimal(18,0) DEFAULT 0,
  [AUTO_FECHA_ALTA] datetime2(3),
  [AUTO_TIPO_COD] decimal(18,0) NOT NULL REFERENCES TIPO_AUTO,
  PRIMARY KEY ([AUTO_CODIGO]) IDENTITY (1,1),
  CONSTRAINT ck_cant_km CHECK ([AUTO_CANT_KMS] >= 0)
);

CREATE TABLE [CLIENTE] (
  [CODIGO_CLIENTE] decimal(18,0),
  [CLIENTE_NOMBRE] nvarchar(255) NOT NULL,
  [CLIENTE_APELLIDO] nvarchar(255) NOT NULL,
  [CLIENTE_DNI] decimal(18,0) NOT NULL,
  [CLIENTE_FECHA_NAC] datetime2(3) NOT NULL,
  [CLIENTE_MAIL] nvarchar(255) NOT NULL,
  [CLIENTE_DIRECCION] nvarchar(255),
  PRIMARY KEY ([CODIGO_CLIENTE]) IDENTITY (1,1)
);

CREATE TABLE [TIPO_X_MODELO] (
  [TIPO_X_MODELO_COD] decimal(18,0),
  [TIPO_AUTO_CODIGO] decimal(18,0) NOT NULL REFERENCES TIPO_AUTO,
  [MODELO_CODIGO] decimal(18,0) NOT NULL REFERENCES AUTO_MODELO,
  PRIMARY KEY ([TIPO_X_MODELO_COD]) IDENTITY (1,1)
);

CREATE TABLE [SUCURSAL] (
  [SUCURSAL_CODIGO] decimal(18,0),
  [SUCURSAL_CIUDAD_COD] decimal(18,0) NOT NULL REFERENCES CIUDAD,
  [SUCURSAL_DIRECCION] nvarchar(255) NOT NULL,
  [SUCURSAL_MAIL] nvarchar(255) NOT NULL,
  [SUCURSAL_TELEFONO] decimal(18,0) NOT NULL,
  PRIMARY KEY ([SUCURSAL_CODIGO]) IDENTITY (1,1)
);

CREATE TABLE [FABRICANTE] (
  [FABRICANTE_CODIGO] decimal(18,0),
  [FABRICANTE_NOMBRE] nvarchar(255) NOT NULL REFERENCES FABRICANTE,
  PRIMARY KEY ([FABRICANTE_CODIGO]) IDENTITY (1,1)
);

CREATE TABLE [AUTO_PARTE_X_FABRICANTE] (
  [AUTO_PARTE_X_FABRICANTE_COD] decimal(18,0),
  [AUTO_PARTE_FABRICANTE_COD] decimal(18,0) NOT NULL REFERENCES AUTO_PARTE,
  [FABRICANTE_CODIGO] decimal(18,0) NOT NULL REFERENCES FABRICANTE,
  PRIMARY KEY ([AUTO_PARTE_X_FABRICANTE_COD]) IDENTITY(1,1) 
);

CREATE TABLE [TIPO_CAJA] (
  [TIPO_CAJA_CODIGO] decimal(18,0),
  [TIPO_CAJA_DESC] nvarchar(255),
  PRIMARY KEY ([TIPO_CAJA_CODIGO])
);

CREATE TABLE [TIPO_AUTO] (
  [TIPO_AUTO_CODIGO] decimal(18,0),
  [TIPO_AUTO_DESC] nvarchar(255),
  [TIPO_AUTO_MODELO_COD] decimal(18,0) NOT NULL REFERENCES TIPO_X_MODELO,
  PRIMARY KEY ([TIPO_AUTO_CODIGO])
);

CREATE TABLE [CIUDAD] (
  [CIUDAD_CODIGO] decimal(18,0),
  [CIUDAD_DESCRIPCION] nvarchar(255) NOT NULL,
  PRIMARY KEY ([CIUDAD_CODIGO]) IDENTITY (1,1)
);

CREATE TABLE [FACTURA] (
  [FACTURA_NRO] decimal(18,0),
  [FACTURA_FECHA] datetime2(3) NOT NULL,
  [FACTURA_PRECIO] decimal(18,2) DEFAULT 0,
  [FACTURA_CANT] decimal(18,0) DEFAULT 0,
  [FACT_SUCURSAL_COD] decimal(18,0) NOT NULL REFERENCES SUCURSAL,
  [FACT_CLIENTE_COD] decimal(18,0) NOT NULL REFERENCES CLIENTE,
  [FACT_PRODUCTO_COD] decimal(18,0) NOT NULL REFERENCES PRODUCTO_OPERACION,
  [TIPO_PRODUCTO] nvarchar(255) NOT NULL REFERENCES PRODUCTO_OPERACION,
  PRIMARY KEY ([FACTURA_NRO])
  CONSTRAINT ck_fact_precio CHECK ([FACTURA_PRECIO] >= 0),
  CONSTRAINT ck_fact_cant CHECK ([FACTURA_CANT] >= 0)
);

CREATE TABLE [COMPRA] (
  [COMPRA_NRO] decimal(18,0),
  [COMPRA_FECHA] datetime2(3) NOT NULL,
  [COMPRA_PRECIO] decimal(18,2) DEFAULT 0,
  [COMPRA_CANT] decimal(18,0) DEFAULT 0,
  [COMPRA_SUCURSAL_COD] decimal(18,0) NOT NULL REFERENCES SUCURSAL,
  [COMPRA_CLIENTE_COD] decimal(18,0) NOT NULL REFERENCES CLIENTE,
  [COMPRA_PRODUCTO_COD] decimal(18,0) NOT NULL REFERENCES PRODUCTO_OPERACION,
  [COMPRA_PRODUCTO_TIPO] nvarchar(255) NOT NULL REFERENCES PRODUCTO_OPERACION,
  PRIMARY KEY ([COMPRA_NRO])
  CONSTRAINT ck_compra_precio CHECK ([FACTURA_PRECIO] >= 0),
  CONSTRAINT ck_compra_cant CHECK ([FACTURA_CANT] >= 0)
);
